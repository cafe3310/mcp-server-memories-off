# 需求: 垃圾回收工具 (garbage_collect_relations)

- **状态**: 待办
- **优先级**: 中

## 1. 目标

创建一个工具，用于查找并清理知识库中因实体被删除或重命名而产生的“断裂链接”（即指向不存在实体的关系），以保证知识库的长期健康和可维护性。

## 2. 工具设计

- **名称**: `garbage_collect_relations`
- **参数**:
    - `library_name` (string, **必需**): 要进行垃圾回收的目标知识库名称。
    - `dry_run` (boolean, 可选, 默认 `true`): 预演模式。如果为 `true`，工具将只报告它找到了哪些断裂链接，而不会执行任何删除操作。

## 3. 实现逻辑

1.  **获取有效实体列表**: 首先，工具需要获取指定知识库中所有当前存在的实体文件名列表，作为一个“有效目标”的集合。
2.  **遍历所有实体**: 工具将遍历知识库中的每一个 `.md` 文件。
3.  **检查关系**: 对于每一个文件，工具将：
    a. 读取其 Front Matter (`_read_file_content(..., 'frontmatter')`)。
    b. 解析 `relations` 数组。
    c. 对于数组中的每一条关系，检查其 `relation to` 字段指向的实体是否存在于第一步获取的“有效目标”集合中。
4.  **识别断裂链接**: 如果一个关系指向的实体不存在，它就被标记为“断裂链接”。
5.  **执行清理或报告**:
    -   如果 `dry_run` 为 `true`，则将所有找到的断裂链接（例如：“在文件 A.md 中，发现指向不存在实体 B 的关系”）汇总并作为结果返回。
    -   如果 `dry_run` 为 `false`，则对于每一个包含断裂链接的文件，工具将在内存中构建一个清除了这些链接的新 Front Matter，然后调用 `_replace_content` 将旧的 Front Matter 替换为新的。
6.  **记录日志**: 所有实际的删除操作都必须被详细地记录到 `journey.yaml` 文件中，以备审计和追溯。
